<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Encryption/Decryption Result</title>
  <link rel="stylesheet" href="/static/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lora:wght@400;500&display=swap" rel="stylesheet">
  <style>
    .classy-pre {
      background: #f5f5f5;
      border-radius: 8px;
      padding: 10px;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Lora', serif;
      font-size: 15px;
      color: #333;
    }
    .key-info {
        background: #fcfcfc;
        padding: 15px;
        border-left: 5px solid var(--classy-accent);
        margin: 15px 0;
        border-radius: 5px;
    }
  </style>
</head>
<body class="fade-in">
  <header>
    <div class="header-container">
      <h1>Classy Document Encryptor</h1>
      <nav>
        <a href="/">Home</a>
        <a href="/encrypt-decrypt">Encrypt/Decrypt</a>
        <a href="/about">About</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="result-container">
      <h2>Operation Result</h2>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for message in messages %}
            <p class="flash-message">{{ message }}</p>
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% if time_taken %}
        <div class="key-info">
          <p><strong>Operation:</strong> {% if plaintext %}Decryption{% elif ciphertext %}Encryption{% endif %}</p>
          <p><strong>Time Taken:</strong> <span style="color: var(--classy-header); font-weight: 700;">{{ time_taken }}</span></p>
        </div>
      {% endif %}

      {% if plaintext or ciphertext %}
        <h3>Output Content</h3>
        <pre class="classy-pre">{{ plaintext or ciphertext }}</pre>
      {% else %}
        <p><em>No output generated. Please try again.</em></p>
      {% endif %}

      {% if generated_key %}
        <div class="key-info">
          <h3>Key Information (Save for Decryption)</h3>
          <p><strong>Generated Key:</strong> <span style="word-break: break-all;">{{ generated_key }}</span></p>
          <p class="help-text">For symmetric ciphers (DES/AES), this is the hex key. For asymmetric ciphers, it contains both Public and Private key components.</p>
        </div>
      {% endif %}

      {% if avalanche_results %}
        <hr class="classy-divider">
        <h3>Confusion/Diffusion (Avalanche) Test Results for {{ avalanche_results.cipher }}</h3>
        <div class="key-info">
            <p><strong>Test Condition:</strong> Flipped {{ avalanche_results.plain_bit_change }} (over {{ avalanche_results.trials }} trials).</p>
            <p><strong>Total Bits Compared:</strong> {{ avalanche_results.total_bits }}</p>
            <p><strong>Bits Changed in Ciphertext:</strong> {{ avalanche_results.bits_changed }}</p>
            <p><strong>Change Percentage:</strong> <span style="color: {% if avalanche_results.passed %}green{% else %}red{% endif %}; font-weight: 700;">{{ avalanche_results.percentage }}</span></p>
            <p class="help-text">A good confusion/diffusion effect (Avalanche) is achieved when the percentage of changed bits in the ciphertext is close to 50% (typically 45% - 55%).</p>
        </div>
      {% endif %}
      {% if steps %}
        <hr class="classy-divider">
        <h3>Step-by-Step Process:</h3>
        <div id="steps-container">
          {% for s in steps %}
            <div class="step hidden">{{ s | safe }}</div>
          {% endfor %}
        </div>
        <button id="start-btn" class="classy-button">Start Animation</button>
        <button id="show-all-btn" class="classy-button">Show All Steps</button>
      {% endif %}

      {% if ciphertext %}
        <hr class="classy-divider">
        <form action="{{ url_for('download_encrypted') }}" method="POST" style="margin-top: 20px;">
          <input type="hidden" name="ciphertext" value="{{ ciphertext }}">
          <button type="submit" class="classy-button">Download Encrypted File</button>
        </form>
      {% endif %}

      <p style="margin-top: 30px;"><a href="/encrypt-decrypt" class="classy-link">Back to Encrypt/Decrypt</a></p>
    </section>
  </main>

  <footer>
    <div class="footer-container">
      <p>&copy; 2025 Classy Encryptor. All Rights Reserved.</p>
    </div>
  </footer>
  <script src="/static/main.js"></script>
</body>
</html>